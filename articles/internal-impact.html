<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using vimpact for estimating vaccine impact - internal • vimpact</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using vimpact for estimating vaccine impact - internal">
<meta property="og:description" content="vimpact">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">vimpact</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/internal-impact.html">Using vimpact for estimating vaccine impact - internal</a>
    </li>
    <li>
      <a href="../articles/using-vimpact.html">Using vimpact for estimating vaccine impact</a>
    </li>
    <li>
      <a href="../articles/vignette.html">Using vimpact for estimating vaccine impact - VIMC members</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="internal-impact_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using vimpact for estimating vaccine impact - internal</h1>
                        <h4 data-toc-skip class="author">Rob Ashton</h4>
            
            <h4 data-toc-skip class="date">2022-02-02</h4>
      
      
      <div class="hidden name"><code>internal-impact.Rmd</code></div>

    </div>

    
    
<!-- DO NOT EDIT THIS FILE - see vignettes_src and make changes there -->
<p>This vignette describes how to use vimpact to calculate impact as a member of VIMC. This requires a connection to the montagu database so can only be used internally. Note that this is all in development and the interface is likely to change.</p>
<div class="section level2">
<h2 id="impact-by-calendar-year-impact-by-birth-year">Impact by calendar year &amp; impact by birth year<a class="anchor" aria-label="anchor" href="#impact-by-calendar-year-impact-by-birth-year"></a>
</h2>
<div class="section level3">
<h3 id="function-interface">Function interface<a class="anchor" aria-label="anchor" href="#function-interface"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">impact</span> <span class="op">&lt;-</span> <span class="fu">vimpact</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_impact.html">calculate_impact</a></span><span class="op">(</span></span>
<span>  <span class="va">con</span>, method <span class="op">=</span> <span class="st">"calendar_year"</span>, touchstone <span class="op">=</span> <span class="st">"201910gavi-5"</span>,</span>
<span>  modelling_group <span class="op">=</span> <span class="st">"CDA-Razavi"</span>,  disease <span class="op">=</span> <span class="st">"HepB"</span>,</span>
<span>  focal_scenario_type <span class="op">=</span> <span class="st">"default"</span>, focal_vaccine_delivery <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>vaccine <span class="op">=</span> <span class="st">"HepB_BD"</span>, activity_type <span class="op">=</span> <span class="st">"routine"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>vaccine <span class="op">=</span> <span class="st">"HepB"</span>, activity_type <span class="op">=</span> <span class="st">"routine"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  baseline_scenario_type <span class="op">=</span> <span class="st">"novac"</span>,</span>
<span>  burden_outcomes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hepb_deaths_acute"</span>, <span class="st">"hepb_deaths_dec_cirrh"</span>,</span>
<span>                      <span class="st">"hepb_deaths_hcc"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">impact</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble [9,898 × 4] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ country       : chr [1:9898] "AFG" "AFG" "AFG" "AFG" ...</span></span>
<span><span class="co">#&gt;  $ burden_outcome: chr [1:9898] "deaths" "deaths" "deaths" "deaths" ...</span></span>
<span><span class="co">#&gt;  $ year          : int [1:9898] 2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 ...</span></span>
<span><span class="co">#&gt;  $ impact        : num [1:9898] 0 0 0 0 0 0 0 53 81 97 ...</span></span></code></pre></div>
<p>Or for impact by birth year, use <code>method = "birth_year"</code>. This will get <code>burden_estimate_set</code> ids for the baseline and focal scenarios for this particular touchstone, modelling group, disease. Then uses those to pull the <code>burden_estimate</code> data for specified <code>burden_outcomes</code>. Optionally filtering on country via <code>countries</code> arg, year via <code>vaccination_years</code> and under 5 age groups if <code>is_under5 = TRUE</code>. We then use raw impact from <code>burden_estimate</code> table and call relevant public facing impact method. For <code>method = "calendar_year"</code> <code>impact_by_calendar_year</code>. For <code>method = "birth_year"</code> <code>impact_by_birth_year</code>.</p>
</div>
<div class="section level3">
<h3 id="recipe-interface">Recipe interface<a class="anchor" aria-label="anchor" href="#recipe-interface"></a>
</h3>
<p>Define a recipe either as a csv or using <code>recipe_template</code></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">recipe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  touchstone <span class="op">=</span> <span class="st">"201910gavi-5"</span>,</span>
<span>  modelling_group <span class="op">=</span> <span class="st">"CDA-Razavi"</span>, disease <span class="op">=</span> <span class="st">"HepB"</span>,</span>
<span>  focal <span class="op">=</span> <span class="st">"default:HepB_BD-routine;HepB-routine"</span>,</span>
<span>  baseline <span class="op">=</span> <span class="st">"novac"</span>,</span>
<span>  burden_outcome <span class="op">=</span> <span class="st">"hepb_deaths_acute,hepb_deaths_dec_cirrh,hepb_deaths_hcc;hepb_cases_acute_severe,hepb_cases_dec_cirrh,hepb_cases_hcc;dalys"</span><span class="op">)</span></span>
<span><span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".csv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">recipe</span>, <span class="va">t</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>This is a set of properties defining what data we want to extract from the db e.g. <code>touchstone</code>, <code>modelling_group</code>, <code>disease</code>, focal and baseline scenarios and <code>burden_outcome</code>. It captures the same info as the args to <code>calculate_impact</code> above. Then use the recipe to define meta data frame</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta</span> <span class="op">&lt;-</span> <span class="fu">vimpact</span><span class="fu">:::</span><span class="fu">get_meta_from_recipe</span><span class="op">(</span>default_recipe <span class="op">=</span> <span class="cn">FALSE</span>, recipe <span class="op">=</span> <span class="va">t</span>, con <span class="op">=</span> <span class="va">con</span><span class="op">)</span></span></code></pre></div>
<p>And use this to calculate impact</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">old_impact</span> <span class="op">&lt;-</span> <span class="fu">vimpact</span><span class="fu">:::</span><span class="fu">get_raw_impact_details</span><span class="op">(</span><span class="va">con</span>, <span class="va">meta</span>, <span class="st">"deaths"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">old_impact</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    9898 obs. of  7 variables:</span></span>
<span><span class="co">#&gt;  $ country       : int  104 104 104 104 104 104 104 104 104 104 ...</span></span>
<span><span class="co">#&gt;  $ time          : int  2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 ...</span></span>
<span><span class="co">#&gt;  $ baseline_value: num  5636 5765 5901 6034 6172 ...</span></span>
<span><span class="co">#&gt;  $ focal_value   : num  5636 5765 5901 6015 6075 ...</span></span>
<span><span class="co">#&gt;  $ value         : num  0 0 0 19 97 180 252 312 344 381 ...</span></span>
<span><span class="co">#&gt;  $ index         : int  1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ burden_outcome: chr  "deaths" "deaths" "deaths" "deaths" ...</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="impact-by-year-of-vaccination">Impact by year of vaccination<a class="anchor" aria-label="anchor" href="#impact-by-year-of-vaccination"></a>
</h2>
<div class="section level3">
<h3 id="function-interface-1">Function interface<a class="anchor" aria-label="anchor" href="#function-interface-1"></a>
</h3>
<p>Very similar to examples for calendar year and birth year, to calculate impact by year of vaccination stratified by activity type run</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">impact</span> <span class="op">&lt;-</span> <span class="fu">vimpact</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_impact.html">calculate_impact</a></span><span class="op">(</span></span>
<span>  <span class="va">con</span>, method <span class="op">=</span> <span class="st">"yov_activity_type"</span>, touchstone <span class="op">=</span> <span class="st">"201910gavi-5"</span>,</span>
<span>  modelling_group <span class="op">=</span> <span class="st">"CDA-Razavi"</span>,  disease <span class="op">=</span> <span class="st">"HepB"</span>,</span>
<span>  focal_scenario_type <span class="op">=</span> <span class="st">"default"</span>, focal_vaccine_delivery <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>vaccine <span class="op">=</span> <span class="st">"HepB_BD"</span>, activity_type <span class="op">=</span> <span class="st">"routine"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>vaccine <span class="op">=</span> <span class="st">"HepB"</span>, activity_type <span class="op">=</span> <span class="st">"routine"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  baseline_scenario_type <span class="op">=</span> <span class="st">"novac"</span>,</span>
<span>  burden_outcomes <span class="op">=</span> <span class="st">"dalys"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">impact</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble [4,279 × 8] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ country       : chr [1:4279] "AFG" "AFG" "AFG" "AFG" ...</span></span>
<span><span class="co">#&gt;  $ vaccine       : chr [1:4279] "HepB" "HepB" "HepB" "HepB" ...</span></span>
<span><span class="co">#&gt;  $ activity_type : chr [1:4279] "routine" "routine" "routine" "routine" ...</span></span>
<span><span class="co">#&gt;  $ year          : int [1:4279] 2007 2008 2009 2010 2011 2012 2013 2014 2015 2016 ...</span></span>
<span><span class="co">#&gt;  $ burden_outcome: chr [1:4279] "dalys" "dalys" "dalys" "dalys" ...</span></span>
<span><span class="co">#&gt;  $ impact        : num [1:4279] 103859 106575 105852 111953 115165 ...</span></span>
<span><span class="co">#&gt;  $ impact_ratio  : num [1:4279] 0.154 0.154 0.154 0.154 0.154 ...</span></span>
<span><span class="co">#&gt;  $ fvps          : num [1:4279] 676396 694088 689380 729111 750028 ...</span></span></code></pre></div>
<p>or use <code>method = "yov_birth_cohort</code> for impact by year of vaccination stratified by birth cohort. This uses the same logic as other impact methods but before calling the public facing impact function it will also extract FVP data from the data base for this <code>touchstone</code> and vaccine delivery. It then calls either <code>impact_by_year_of_vaccination_activity_type</code> or <code>impact_by_year_of_vaccination_birth_cohort</code> to get impact.</p>
</div>
<div class="section level3">
<h3 id="recipe-interface-1">Recipe interface<a class="anchor" aria-label="anchor" href="#recipe-interface-1"></a>
</h3>
<p>We can re-use the recipe from above and get meta table for this method</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta</span> <span class="op">&lt;-</span> <span class="fu">vimpact</span><span class="fu">:::</span><span class="fu">get_meta_from_recipe</span><span class="op">(</span>default_recipe <span class="op">=</span> <span class="cn">FALSE</span>, recipe <span class="op">=</span> <span class="va">t</span>,</span>
<span>                                      method <span class="op">=</span> <span class="st">"method2a"</span>, con <span class="op">=</span> <span class="va">con</span><span class="op">)</span></span></code></pre></div>
<p>Then use this to get raw impact</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">old_raw_impact</span> <span class="op">&lt;-</span> <span class="fu">vimpact</span><span class="fu">:::</span><span class="fu">get_raw_impact_details</span><span class="op">(</span><span class="va">con</span>, <span class="va">meta</span>, <span class="st">"dalys"</span><span class="op">)</span></span></code></pre></div>
<p>Extract the fvp data and map output to required interface</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fvps</span> <span class="op">&lt;-</span> <span class="fu">vimpact</span><span class="fu">::</span><span class="fu"><a href="../reference/extract_vaccination_history.html">extract_vaccination_history</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"201910gavi-5"</span>, year_min <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>                                             year_max <span class="op">=</span> <span class="fl">2030</span>,</span>
<span>                                             disease_to_extract <span class="op">=</span> <span class="st">"HepB"</span><span class="op">)</span></span>
<span><span class="co">#&gt; User defined touchstone version is used.</span></span>
<span><span class="co">#&gt; Converting input coverage data......</span></span>
<span><span class="co">#&gt; Extracted interpolated population.</span></span>
<span><span class="co">#&gt; Extracted raw coverage data...</span></span>
<span><span class="co">#&gt; Transformed coverage data.</span></span>
<span><span class="va">fvps</span><span class="op">$</span><span class="va">fvps</span> <span class="op">&lt;-</span> <span class="va">fvps</span><span class="op">$</span><span class="va">fvps_adjusted</span></span>
<span><span class="va">fvps</span><span class="op">$</span><span class="va">country</span> <span class="op">&lt;-</span> <span class="va">fvps</span><span class="op">$</span><span class="va">country_nid</span></span></code></pre></div>
<p>Then can use <code>meta</code>, <code>raw_impact</code> and <code>fvps</code> to calculate impact by year of vaccination</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">old_impact</span> <span class="op">&lt;-</span> <span class="fu">vimpact</span><span class="fu">:::</span><span class="fu">impact_by_year_of_vaccination</span><span class="op">(</span></span>
<span>  <span class="va">meta</span>, <span class="va">old_raw_impact</span>, <span class="va">fvps</span>, vaccination_years <span class="op">=</span> <span class="fl">2000</span><span class="op">:</span><span class="fl">2030</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">old_impact</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    4964 obs. of  27 variables:</span></span>
<span><span class="co">#&gt;  $ country             : int  4 4 4 4 4 4 4 4 4 4 ...</span></span>
<span><span class="co">#&gt;  $ vaccine             : chr  "HepB_BD" "HepB" "HepB_BD" "HepB_BD" ...</span></span>
<span><span class="co">#&gt;  $ activity_type       : chr  "routine" "routine" "routine" "routine" ...</span></span>
<span><span class="co">#&gt;  $ scenario_description: chr  "best-estimates" "best-estimates" "best-estimates" "best-estimates" ...</span></span>
<span><span class="co">#&gt;  $ coverage_set        : int  1750 1751 1750 1750 1751 1751 1751 1751 1751 1751 ...</span></span>
<span><span class="co">#&gt;  $ delivery_id         : int  487 3093 1169 1175 3376 4029 4272 3375 4564 3096 ...</span></span>
<span><span class="co">#&gt;  $ disease             : chr  "HepB" "HepB" "HepB" "HepB" ...</span></span>
<span><span class="co">#&gt;  $ scenario_type       : chr  "default" "default" "default" "default" ...</span></span>
<span><span class="co">#&gt;  $ gavi_support_level  : chr  "with" "with" "with" "with" ...</span></span>
<span><span class="co">#&gt;  $ year                : int  2016 2017 2014 2025 2030 2015 2019 2027 2029 2020 ...</span></span>
<span><span class="co">#&gt;  $ gavi_support        : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">#&gt;  $ gender              : chr  "Both" "Both" "Both" "Both" ...</span></span>
<span><span class="co">#&gt;  $ age                 : num  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ target_source       : num  1118424 1131834 1103729 1180725 1188620 ...</span></span>
<span><span class="co">#&gt;  $ coverage_source     : num  0.18 0.66 0.04 0.473 0.749 ...</span></span>
<span><span class="co">#&gt;  $ cohort_size         : num  1118424 1131834 1103729 1180725 1188620 ...</span></span>
<span><span class="co">#&gt;  $ delivery_population : num  1118424 1131834 1103729 1180725 1188620 ...</span></span>
<span><span class="co">#&gt;  $ fvps_source         : num  201316 747010 44149 558483 890514 ...</span></span>
<span><span class="co">#&gt;  $ fvps_adjusted       : num  201316 747010 44149 558483 890514 ...</span></span>
<span><span class="co">#&gt;  $ coverage_adjusted   : num  0.18 0.66 0.04 0.473 0.749 ...</span></span>
<span><span class="co">#&gt;  $ country_nid         : int  4 4 4 4 4 4 4 4 4 4 ...</span></span>
<span><span class="co">#&gt;  $ fvps                : num  201316 747010 44149 558483 890514 ...</span></span>
<span><span class="co">#&gt;  $ time                : num  2016 2017 2014 2025 2030 ...</span></span>
<span><span class="co">#&gt;  $ burden_outcome      : chr  "dalys" "dalys" "dalys" "dalys" ...</span></span>
<span><span class="co">#&gt;  $ impact_ratio        : num  0.154 0.154 0.154 0.154 0.154 ...</span></span>
<span><span class="co">#&gt;  $ impact              : num  30912 114701 6779 85754 136736 ...</span></span>
<span><span class="co">#&gt;  $ index               : int  1 1 1 1 1 1 1 1 1 1 ...</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="comparison">Comparison<a class="anchor" aria-label="anchor" href="#comparison"></a>
</h2>
<p><code>calculate_impact</code> has a very similar interface as a single row in an impact recipe. The output is slightly different format but output from previous method can be transformed into same format.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">country</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"country"</span><span class="op">)</span></span>
<span><span class="va">old_impact</span> <span class="op">&lt;-</span> <span class="va">old_impact</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">country</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"country"</span> <span class="op">=</span> <span class="st">"nid"</span><span class="op">)</span>, copy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>country <span class="op">=</span> <span class="va">id</span>, <span class="va">vaccine</span>, <span class="va">activity_type</span>, year <span class="op">=</span> <span class="va">time</span>,</span>
<span>                <span class="va">burden_outcome</span>, <span class="va">impact</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">impact</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">activity_type</span>, <span class="va">country</span>, <span class="va">year</span>, <span class="va">vaccine</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">old_impact</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    4279 obs. of  6 variables:</span></span>
<span><span class="co">#&gt;  $ country       : chr  "AFG" "AFG" "AFG" "AFG" ...</span></span>
<span><span class="co">#&gt;  $ vaccine       : chr  "HepB" "HepB" "HepB" "HepB" ...</span></span>
<span><span class="co">#&gt;  $ activity_type : chr  "routine" "routine" "routine" "routine" ...</span></span>
<span><span class="co">#&gt;  $ year          : num  2007 2008 2009 2010 2011 ...</span></span>
<span><span class="co">#&gt;  $ burden_outcome: chr  "dalys" "dalys" "dalys" "dalys" ...</span></span>
<span><span class="co">#&gt;  $ impact        : num  103859 106575 105852 111953 115165 ...</span></span></code></pre></div>
<p>and we can see from a plot that the output is very similar</p>
<div class="section level3">
<h3 id="hepb">HepB<a class="anchor" aria-label="anchor" href="#hepb"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">htmltools</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/htmltools/man/builder.html" class="external-link">tags</a></span><span class="op">$</span><span class="fu">iframe</span><span class="op">(</span> </span>
<span>  src <span class="op">=</span> <span class="st">"impact_comparisons_hepb.html"</span>, </span>
<span>  width <span class="op">=</span> <span class="st">"100%"</span>, </span>
<span>  height <span class="op">=</span> <span class="st">"400"</span>, </span>
<span>  scrolling <span class="op">=</span> <span class="st">"no"</span>, </span>
<span>  seamless <span class="op">=</span> <span class="st">"seamless"</span>, </span>
<span>  frameBorder <span class="op">=</span> <span class="st">"0"</span>, </span>
<span>  `data-external` <span class="op">=</span> <span class="st">"1"</span> </span>
<span><span class="op">)</span></span></code></pre></div>
<iframe src="impact_comparisons_hepb.html" width="100%" height="400" scrolling="no" seamless="seamless" frameborder="0" data-external="1"></iframe>
</div>
<div class="section level3">
<h3 id="measles">Measles<a class="anchor" aria-label="anchor" href="#measles"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">htmltools</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/htmltools/man/builder.html" class="external-link">tags</a></span><span class="op">$</span><span class="fu">iframe</span><span class="op">(</span> </span>
<span>  src <span class="op">=</span> <span class="st">"impact_comparisons_measles.html"</span>, </span>
<span>  width <span class="op">=</span> <span class="st">"100%"</span>, </span>
<span>  height <span class="op">=</span> <span class="st">"400"</span>, </span>
<span>  scrolling <span class="op">=</span> <span class="st">"no"</span>, </span>
<span>  seamless <span class="op">=</span> <span class="st">"seamless"</span>, </span>
<span>  frameBorder <span class="op">=</span> <span class="st">"0"</span>, </span>
<span>  `data-external` <span class="op">=</span> <span class="st">"1"</span> </span>
<span><span class="op">)</span></span></code></pre></div>
<iframe src="impact_comparisons_measles.html" width="100%" height="400" scrolling="no" seamless="seamless" frameborder="0" data-external="1"></iframe>
</div>
<div class="section level3">
<h3 id="comparisons-of-hepb-measles-yf">Comparisons of HepB, Measles &amp; YF<a class="anchor" aria-label="anchor" href="#comparisons-of-hepb-measles-yf"></a>
</h3>
<p>This shows bars of mean difference between old impact &amp; new impact method for each country for HepB, Measles and YF. Tooltips show the number of observations and the min and max order of the values. i.e. an impact of 23432.342 has order 5.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">htmltools</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/htmltools/man/builder.html" class="external-link">tags</a></span><span class="op">$</span><span class="fu">iframe</span><span class="op">(</span> </span>
<span>  src <span class="op">=</span> <span class="st">"impact_comparisons.html"</span>, </span>
<span>  width <span class="op">=</span> <span class="st">"100%"</span>, </span>
<span>  height <span class="op">=</span> <span class="st">"400"</span>, </span>
<span>  scrolling <span class="op">=</span> <span class="st">"no"</span>, </span>
<span>  seamless <span class="op">=</span> <span class="st">"seamless"</span>, </span>
<span>  frameBorder <span class="op">=</span> <span class="st">"0"</span>, </span>
<span>  `data-external` <span class="op">=</span> <span class="st">"1"</span> </span>
<span><span class="op">)</span></span></code></pre></div>
<iframe src="impact_comparisons.html" width="100%" height="400" scrolling="no" seamless="seamless" frameborder="0" data-external="1"></iframe>
<p>There are small differences in impact because of differences in precision. <code>calculate_impact</code> tries to do large parts of the aggregation on the database where <code>burden_estimate</code> values are stored as Postgres <code>real</code> type which has 4 bytes of storage size and 6 decimal digits of precision. Whereas if we pull this before aggregation the values are stored in R as doubles which are much higher precision leading to small differences when aggregated.</p>
<p><code>calculate_impact</code> at the moment won’t be able to generate impact for you for more than 1 set of scenario comparisons. Next steps will be to add a wrapper which can take some data like the impact recipe and call <code>calculate_imapct</code> for multiple scenarios.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Rich FitzJohn.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
