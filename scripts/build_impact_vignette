#!/usr/bin/env bash
# We can't run the internal-impact vignette on a computer that doesn't
# have access to montagu DB (including CI) so we pre-compile it
# ocassinally here. The version in vignettes_src should be edited,
# then this script run to create the version in vignettes
(cd vignettes_src && Rscript -e 'knitr::knit("internal-impact.Rmd")')
header="DO NOT EDIT THIS FILE - see vignettes_src and make changes there"
widget=' \
### HepB \
```{r} \
htmltools::tags$iframe( \
  src = "impact_comparisons_hepb.html", \
  width = "100%", \
  height = "400", \
  scrolling = "no", \
  seamless = "seamless", \
  frameBorder = "0", \
  `data-external` = "1" \
)\
```\
\
### YF \
```{r} \
htmltools::tags$iframe( \
  src = "impact_comparisons_yf.html", \
  width = "100%", \
  height = "400", \
  scrolling = "no", \
  seamless = "seamless", \
  frameBorder = "0", \
  `data-external` = "1" \
)\
```\
\
### Measles \
```{r} \
htmltools::tags$iframe( \
  src = "impact_comparisons_measles.html", \
  width = "100%", \
  height = "400", \
  scrolling = "no", \
  seamless = "seamless", \
  frameBorder = "0", \
  `data-external` = "1" \
)\
```'
sed -s 's/[[:space:]]*$//' vignettes_src/internal-impact.md |
    sed 's/\r//g' |
    sed "s/HEADER/$header/" |
    sed "s/<!-- WIDGET -->/$widget/" > vignettes/internal-impact.Rmd
cp vignettes_src/impact_comparisons_hepb.html vignettes/impact_comparisons_hepb.html
cp vignettes_src/impact_comparisons_yf.html vignettes/impact_comparisons_yf.html
cp vignettes_src/impact_comparisons_measles.html vignettes/impact_comparisons_measles.html
